# 一、概述
本 Python 脚本用于检查 MySQL 服务的运行状态，包括进程是否存在以及端口是否处于监听状态，并尝试连接数据库以确认其可用性。该脚本在高可用架构（如结合 Keepalived）中，可用于实时监控 MySQL 服务，确保在出现异常时能及时响应和处理，保障数据库服务的稳定性。
# 二、功能特性
进程与端口检查：通过系统命令检查 MySQL 进程数量以及对应端口的监听情况，判断 MySQL 服务是否正常启动。
数据库连接测试：利用pymysql库尝试连接 MySQL 数据库，验证数据库的可访问性。
命令行参数支持：支持通过命令行参数动态指定要检查的 MySQL 主机和端口，提高脚本的灵活性。
日志记录：详细记录检查过程中的关键信息和错误，便于故障排查和系统监控。
文件锁机制：使用文件锁避免多个脚本实例同时运行，防止资源竞争和不一致的检查结果。
# 三、使用方法
（一）依赖安装
确保系统已安装 Python 3 环境。
安装所需的 Python 库，使用以下命令：
bash
pip install pymysql filelock

（二）配置文件
脚本从config模块中读取数据库的默认连接信息，包括主机（dbhost）、端口（dbport）、用户名（dbuser）和密码（dbpassword）。请根据实际情况在config.py文件中配置正确的数据库连接参数。
（三）命令行参数
可通过命令行参数覆盖默认的数据库主机和端口配置。支持的参数如下：
-h：指定 MySQL 主机地址，例如：-h 192.168.1.100
-P：指定 MySQL 端口，例如：-P 3306
示例：运行脚本检查192.168.1.100主机上的3306端口的 MySQL 服务状态：
bash
python3 checkMySQL.py -h 192.168.1.100 -P 3306
（四）执行脚本
在确保依赖安装和参数配置正确后，在命令行中执行脚本：
bash
python3 checkMySQL.py
脚本执行后，会在/tmp/kp_check.log文件中记录检查过程和结果。正常情况下，脚本返回值为 0；若检查过程中出现异常，如 MySQL 进程未运行、端口未监听或数据库连接失败等，脚本返回值为 1。

# 四、注意事项
确保脚本运行的用户具有执行系统命令（如ps、netstat）的权限，若使用sudo，请提前配置好sudo免密执行相关命令。
请根据实际环境调整日志文件路径（/tmp/kp_check.log）和日志记录级别（当前为DEBUG），以满足不同的监控和调试需求。
在高可用环境中使用时，需结合相关工具（如 Keepalived）的配置，确保脚本能正确地被调用和处理返回结果，实现 MySQL 服务的自动监控和故障转移。
